

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="phoenix">
  <meta name="keywords" content="">
  
    <meta name="description" content="Docker 官方文档地址:https:&#x2F;&#x2F;www.docker.com&#x2F;get-started 中文参考手册:https:&#x2F;&#x2F;docker_practice.gitee.io&#x2F;zh-cn&#x2F;  1. Docker的基本概念1.1 什么是DockerDocker 最初是 dotCloud 公司创始人 Solomon Hykes 在法国期间发起的一个公司内部项目，它是基于 dotCloud 公司多年云">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker">
<meta property="og:url" content="https://hailong-bot.github.io/2024/05/11/Docker/index.html">
<meta property="og:site_name" content="hailong-bot">
<meta property="og:description" content="Docker 官方文档地址:https:&#x2F;&#x2F;www.docker.com&#x2F;get-started 中文参考手册:https:&#x2F;&#x2F;docker_practice.gitee.io&#x2F;zh-cn&#x2F;  1. Docker的基本概念1.1 什么是DockerDocker 最初是 dotCloud 公司创始人 Solomon Hykes 在法国期间发起的一个公司内部项目，它是基于 dotCloud 公司多年云">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.imgur.com/pwU9rfo.png">
<meta property="og:image" content="https://i.imgur.com/k9kZxJn.png">
<meta property="og:image" content="https://i.imgur.com/6t0ZMvR.png">
<meta property="og:image" content="https://i.imgur.com/qULQy2h.png">
<meta property="og:image" content="https://i.imgur.com/mYIKz3o.png">
<meta property="og:image" content="https://i.imgur.com/teEfIcy.png">
<meta property="og:image" content="https://i.imgur.com/4y60ija.png">
<meta property="og:image" content="https://i.imgur.com/nZMAhP9.png">
<meta property="og:image" content="https://i.imgur.com/HNAdhQ7.png">
<meta property="og:image" content="https://i.imgur.com/6BhHiZO.png">
<meta property="og:image" content="https://i.imgur.com/C9PS4pG.jpeg">
<meta property="og:image" content="https://i.imgur.com/CxmN9fd.png">
<meta property="article:published_time" content="2024-05-11T12:52:00.000Z">
<meta property="article:modified_time" content="2024-12-12T12:49:52.570Z">
<meta property="article:author" content="phoenix">
<meta property="article:tag" content="微服务">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.imgur.com/pwU9rfo.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Docker - hailong-bot</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"hailong-bot.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":false},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":2},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.1.1"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>phoenix</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-category-fill"></i>
                <span>Go系列</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Go%E7%B3%BB%E5%88%97/Go%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5" target="_self">
                    <i class="iconfont icon-archive-fill"></i>
                    <span>Go进阶训练营</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/Go%E7%B3%BB%E5%88%97/%E6%AF%8F%E6%97%A5%E4%B8%80%E5%BA%93" target="_self">
                    <i class="iconfont icon-archive-fill"></i>
                    <span>Go每日一库</span>
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-category-fill"></i>
                <span>醍醐灌顶</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/%E9%86%8D%E9%86%90%E7%81%8C%E9%A1%B6/%E6%8A%80%E6%9C%AF%E7%AF%87" target="_self">
                    <i class="iconfont icon-archive-fill"></i>
                    <span>技术篇</span>
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-category-fill"></i>
                <span>前端</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/%E5%A4%A7%E5%89%8D%E7%AB%AF/React" target="_self">
                    <i class="iconfont icon-archive-fill"></i>
                    <span>React</span>
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Docker"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-05-11 20:52" pubdate>
          2024年5月11日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          5.8k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          48 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-right: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="容器"
        id="heading-22c799040acdb2601b437ed5449de076" role="tab" data-toggle="collapse" href="#collapse-22c799040acdb2601b437ed5449de076"
        aria-expanded="true"
      >
        容器
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-22c799040acdb2601b437ed5449de076"
           role="tabpanel" aria-labelledby="heading-22c799040acdb2601b437ed5449de076">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2024/05/11/Docker/" title="Docker"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Docker</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
</div>


  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Docker</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><ul>
<li>官方文档地址:<a target="_blank" rel="noopener" href="https://www.docker.com/get-started">https://www.docker.com/get-started</a></li>
<li>中文参考手册:<a target="_blank" rel="noopener" href="https://docker_practice.gitee.io/zh-cn/">https://docker_practice.gitee.io/zh-cn/</a></li>
</ul>
<h2 id="1-Docker的基本概念"><a href="#1-Docker的基本概念" class="headerlink" title="1. Docker的基本概念"></a>1. Docker的基本概念</h2><h3 id="1-1-什么是Docker"><a href="#1-1-什么是Docker" class="headerlink" title="1.1 什么是Docker"></a>1.1 什么是Docker</h3><p>Docker 最初是 dotCloud 公司创始人 Solomon Hykes 在法国期间发起的一个公司内部项目，它是基于 dotCloud 公司多年云服务技术的一次革新，并于 2013 年 3 月以 Apache 2.0 授权协议开源，主要项目代码在 GitHub 上进行维护。Docker 项目后来还加入了 Linux 基金会，并成立推动 开放容器联盟（OCI）。 Docker 自开源后受到广泛的关注和讨论，至今其 GitHub 项目 已经超过 5 万 7 千个星标和一万多个 fork。甚至由于 Docker 项目的火爆，在 2013 年底，dotCloud 公司决定改名为 Docker。Docker 最初是在 Ubuntu 12.04 上开发实现的；Red Hat 则从 RHEL 6.5 开始对 Docker 进行支持；Google 也在其 PaaS 产品中广泛应用 Docker。 Docker 使用 Google 公司推出的 Go 语言 进行开发实现，基于 Linux 内核的 cgroup，namespace，以及 OverlayFS 类的 Union FS 等技术，对进程进行封装隔离，属于操作系统层面的虚拟化技术。由于隔离的进程独立于宿主和其它的隔离的进程，因此也称其为容器。</p>
<h3 id="1-2-为什么是Docker"><a href="#1-2-为什么是Docker" class="headerlink" title="1.2 为什么是Docker"></a>1.2 为什么是Docker</h3><ul>
<li><p><code>在开发的时候，在本机测试环境可以跑，生产环境跑不起来</code></p>
<p>这里我们拿java Web应用程序举例，我们一个java Web应用程序涉及很多东西，比如jdk、tomcat、mysql等软件环境。当这些其中某一项版本不一致的时候，可能就会导致应用程序跑不起来这种情况。Docker则将程序以及使用软件环境直接打包在一起，无论在那个机器上保证了环境一致。</p>
<p><strong>优势1: 一致的运行环境,更轻松的迁移</strong></p>
</li>
<li><p><code>服务器自己的程序挂了，结果发现是别人程序出了问题把内存吃完了，自己程序因为内存不够就挂了</code></p>
<p>这种也是一种比较常见的情况，如果你的程序重要性不是特别高的话，公司基本上不可能让你的程序独享一台服务器的，这时候你的服务器就会跟公司其他人的程序共享一台服务器，所以不可避免地就会受到其他程序的干扰，导致自己的程序出现问题。Docker就很好解决了环境隔离的问题，别人程序不会影响到自己的程序。</p>
<p><strong>优势2：对进程进行封装隔离,容器与容器之间互不影响,更高效的利用系统资源</strong></p>
</li>
<li><p><code>公司要弄一个活动，可能会有大量的流量进来，公司需要再多部署几十台服务器</code></p>
<p>在没有Docker的情况下，要在几天内部署几十台服务器，这对运维来说是一件非常折磨人的事，而且每台服务器的环境还不一定一样，就会出现各种问题，最后部署地头皮发麻。用Docker的话，我只需要将程序打包到镜像，你要多少台服务，我就给力跑多少容器，极大地提高了部署效率。</p>
<p><strong>优势3: 通过镜像复制N多个环境一致容器</strong></p>
</li>
</ul>
<h3 id="1-3-Docker和虚拟机的区别"><a href="#1-3-Docker和虚拟机的区别" class="headerlink" title="1.3 Docker和虚拟机的区别"></a>1.3 Docker和虚拟机的区别</h3><blockquote>
<p>关于Docker与虚拟机的区别，我在网上找到的一张图，非常直观形象地展示出来，话不多说，直接上图。</p>
</blockquote>
<p><img src="https://i.imgur.com/pwU9rfo.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><code>比较上面两张图，我们发现虚拟机是携带操作系统，本身很小的应用程序却因为携带了操作系统而变得非常大，很笨重</code>。Docker是不携带操作系统的，所以Docker的应用就非常的轻巧。另外在调用宿主机的CPU、磁盘等等这些资源的时候，拿内存举例，虚拟机是利用Hypervisor去虚拟化内存，整个调用过程是虚拟内存-&gt;虚拟物理内存-&gt;真正物理内存，但是Docker是利用Docker Engine去调用宿主的的资源，这时候过程是虚拟内存-&gt;真正物理内存。</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">传统虚拟机</th>
<th align="left">Docker容器</th>
</tr>
</thead>
<tbody><tr>
<td align="left">磁盘占用</td>
<td align="left">几个GB到几十个GB左右</td>
<td align="left">几十MB到几百MB左右</td>
</tr>
<tr>
<td align="left">CPU内存占用</td>
<td align="left">虚拟操作系统非常占用CPU和内存</td>
<td align="left">Docker引擎占用极低</td>
</tr>
<tr>
<td align="left">启动速度</td>
<td align="left">（从开机到运行项目）几分钟</td>
<td align="left">（从开启容器到运行项目）几秒</td>
</tr>
<tr>
<td align="left">安装管理</td>
<td align="left">需要专门的运维技术</td>
<td align="left">安装、管理方便</td>
</tr>
<tr>
<td align="left">应用部署</td>
<td align="left">每次部署都费时费力</td>
<td align="left">从第二次部署开始轻松简捷</td>
</tr>
<tr>
<td align="left">耦合性</td>
<td align="left">多个应用服务安装到一起，容易互相影响</td>
<td align="left">每个应用服务一个容器，达成隔离</td>
</tr>
<tr>
<td align="left">系统依赖</td>
<td align="left">无</td>
<td align="left">需求相同或相似的内核，目前推荐是Linux</td>
</tr>
</tbody></table>
<hr>
<h2 id="2-Docker的安装"><a href="#2-Docker的安装" class="headerlink" title="2. Docker的安装"></a>2. Docker的安装</h2><blockquote>
<p>以centos7为例 文档： <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p>
</blockquote>
<ul>
<li><p>卸载原始docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo yum remove docker \<br>                  docker-client \<br>                  docker-client-latest \<br>                  docker-common \<br>                  docker-latest \<br>                  docker-latest-logrotate \<br>                  docker-logrotate \<br>                  docker-engine<br></code></pre></td></tr></table></figure>
</li>
<li><p>安装docker依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo yum install -y yum-utils<br>sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo <span class="hljs-comment"># 国内可能无法使用 可以使用下面的镜像源</span><br><span class="hljs-comment"># sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>安装Docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin<br></code></pre></td></tr></table></figure>
</li>
<li><p>兼容性卸载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 卸载旧版本的docker</span><br>yum remove docker \<br>           docker-client \<br>           docker-client-latest \<br>           docker-common \<br>           docker-latest \<br>           docker-latest-logrotate \<br>           docker-logrotate \<br>           docker-selinux \<br>           docker-engine-selinux \<br>           docker-engine<br><span class="hljs-comment"># 卸载新版本的docker（叫docker-ce）</span><br>yum remove docker-ce \<br>           docker-ce-cli \<br>           containerd<br><br><span class="hljs-comment"># 停止删除服务</span><br>systemctl stop docker<br><span class="hljs-built_in">rm</span> -rf /etc/systemd/system/docker.service.d<br><span class="hljs-built_in">rm</span> -rf /etc/systemd/system/docker.service<br><span class="hljs-built_in">rm</span> -rf /var/lib/docker<br><span class="hljs-built_in">rm</span> -rf /var/run/docker<br><span class="hljs-built_in">rm</span> -rf /usr/local/docker<br><span class="hljs-built_in">rm</span> -rf /etc/docker<br><span class="hljs-built_in">rm</span> -rf /usr/bin/docker* /usr/bin/containerd* /usr/bin/runc /usr/bin/ctr<br></code></pre></td></tr></table></figure>

<p>删除之后再进行<strong>安装</strong>可能会遇到报错</p>
<p><img src="https://i.imgur.com/k9kZxJn.png" srcset="/img/loading.gif" lazyload alt="image-20240528220125947"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看冲突的依赖包</span><br>yum list installed | grep docker<br><span class="hljs-comment"># 删除后安装其他指定版本</span><br>rpm -e docker-client.x86_64、rpm -e docker-common.x86_64<br></code></pre></td></tr></table></figure></li>
</ul>
<p>​	<img src="https://i.imgur.com/6t0ZMvR.png" srcset="/img/loading.gif" lazyload alt="image-20240528220350909"></p>
<h2 id="3-Docker的核心架构"><a href="#3-Docker的核心架构" class="headerlink" title="3. Docker的核心架构"></a>3. Docker的核心架构</h2><p><img src="https://i.imgur.com/qULQy2h.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li><code>镜像:</code> 一个镜像代表一个应用环境,他是一个只读的文件,如 mysql镜像,tomcat镜像,nginx镜像等</li>
<li><code>容器:</code> 镜像每次运行之后就是产生一个容器,就是正在运行的镜像,特点就是可读可写</li>
<li><code>仓库:</code>用来存放镜像的位置,类似于maven仓库,也是镜像下载和上传的位置</li>
<li><code>dockerFile:</code>docker生成镜像配置文件,用来书写自定义镜像的一些配置</li>
<li><code>tar:</code>一个对镜像打包的文件,日后可以还原成镜像</li>
</ul>
<h2 id="4-Docker配置阿里云镜像加速"><a href="#4-Docker配置阿里云镜像加速" class="headerlink" title="4. Docker配置阿里云镜像加速"></a>4. Docker配置阿里云镜像加速</h2><ul>
<li><code>访问阿里云登录自己账号查看docker镜像加速服务</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo mkdir -p /etc/docker<br>sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;<br>&#123;<br>  &quot;registry-mirrors&quot;: [&quot;https://lz2nib3q.mirror.aliyuncs.com&quot;]<br>&#125;<br>EOF<br>sudo systemctl daemon-reload<br>sudo systemctl restart docker<br></code></pre></td></tr></table></figure>

<ul>
<li><code>验证docker的镜像加速是否生效</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost ~]# docker info<br>		..........<br>    127.0.0.0/8<br>   Registry Mirrors:<br>    &#x27;https://lz2nib3q.mirror.aliyuncs.com/&#x27;<br>   Live Restore Enabled: false<br>   Product License: Community Engine<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="5-常用命令"><a href="#5-常用命令" class="headerlink" title="5. 常用命令"></a>5. 常用命令</h2><h3 id="5-1-辅助命令"><a href="#5-1-辅助命令" class="headerlink" title="5.1 辅助命令"></a>5.1 辅助命令</h3><pre><code class="hljs">    docker version	--------------------------	查看docker的信息
    docker info		--------------------------	查看更详细的信息
    docker --help	--------------------------	帮助命令
</code></pre>
<h3 id="5-2-Images-镜像命令"><a href="#5-2-Images-镜像命令" class="headerlink" title="5.2 Images 镜像命令"></a>5.2 Images 镜像命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1.查看本机中所有镜像</span><br>	docker images	--------------------------	列出本地所有镜像<br>		-a			列出所有镜像（包含中间映像层）<br>  	-q			只显示镜像<span class="hljs-built_in">id</span><br><span class="hljs-comment"># 2.搜索镜像</span><br>	docker search [options] 镜像名	-------------------	去dockerhub上查询当前镜像<br>		-s 指定值		列出收藏数不少于指定值的镜像<br>  	--no-trunc	  显示完整的镜像信息<br><span class="hljs-comment"># 3.从仓库下载镜像</span><br>	docker pull 镜像名[:TAG|@DIGEST]	----------------- 下载镜像<br><span class="hljs-comment"># 4.删除镜像</span><br>	docker rmi 镜像名	--------------------------  删除镜像<br>		-f		强制删除<br></code></pre></td></tr></table></figure>

<h3 id="5-3-Container命令"><a href="#5-3-Container命令" class="headerlink" title="5.3 Container命令"></a>5.3 Container命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1.运行容器</span><br>docker run 镜像名	--------------------------	镜像名新建并启动容器<br>    --name 					别名为容器起一个名字<br>    -d							启动守护式容器（在后台启动容器）<br>    -p 							映射端口号：原始端口号		 指定端口号启动<br><br>例：docker run -it --name myTomcat -p 8888:8080 tomcat<br>    docker run -d --name myTomcat -P tomcat<br><br><span class="hljs-comment"># 2.查看运行的容器</span><br>docker ps					--------------------------	列出所有正在运行的容器<br>    -a			正在运行的和历史运行过的容器<br>    -q			静默模式，只显示容器编号<br><br><span class="hljs-comment"># 3.停止|关闭|重启容器</span><br>docker start   容器名字或者容器<span class="hljs-built_in">id</span>  --------------- 开启容器<br>docker restart 容器名或者容器<span class="hljs-built_in">id</span>    --------------- 重启容器<br>docker stop  容器名或者容器<span class="hljs-built_in">id</span> 	    ------------------ 正常停止容器运行<br>docker <span class="hljs-built_in">kill</span>  容器名或者容器<span class="hljs-built_in">id</span>      ------------------ 立即停止容器运行<br><br><span class="hljs-comment"># 4.删除容器</span><br>docker <span class="hljs-built_in">rm</span> -f 容器<span class="hljs-built_in">id</span>和容器名     <br>docker <span class="hljs-built_in">rm</span> -f $(docker ps -aq)		--------------------------	删除所有容器<br><br><span class="hljs-comment"># 5.查看容器内进程</span><br>docker top 容器<span class="hljs-built_in">id</span>或者容器名 ------------------ 查看容器内的进程<br><br><span class="hljs-comment"># 6.查看查看容器内部细节</span><br>docker inspect 容器<span class="hljs-built_in">id</span> 		------------------ 查看容器内部细节<br><br><span class="hljs-comment"># 7.查看容器的运行日志</span><br>docker logs [OPTIONS] 容器<span class="hljs-built_in">id</span>或容器名	------------------ 查看容器日志<br>    -t			 加入时间戳<br>    -f			 跟随最新的日志打印<br>    --<span class="hljs-built_in">tail</span> 	 数字	显示最后多少条<br><br><span class="hljs-comment"># 8.进入容器内部</span><br>docker <span class="hljs-built_in">exec</span> [options] 容器<span class="hljs-built_in">id</span> 容器内命令 ------------------ 进入容器执行命令<br>		-i		以交互模式运行容器，通常与-t一起使用<br>    -t		分配一个伪终端    shell窗口   bash <br><br><span class="hljs-comment"># 9.容器和宿主机之间复制文件</span><br>docker <span class="hljs-built_in">cp</span> 文件|目录 容器<span class="hljs-built_in">id</span>:容器路径           -----------------   将宿主机复制到容器内部<br>docker <span class="hljs-built_in">cp</span> 容器<span class="hljs-built_in">id</span>:容器内资源路径 宿主机目录路径  -----------------   将容器内资源拷贝到主机上<br><br><span class="hljs-comment"># 10.数据卷(volum)实现与宿主机共享目录</span><br>docker run -v 宿主机的路径|任意别名:/容器内的路径 镜像名<br>注意: <br>    1.如果是宿主机路径必须是绝对路径,宿主机目录会覆盖容器内目录内容<br>    2.如果是别名则会在docker运行容器时自动在宿主机中创建一个目录,并将容器目录文件复制到宿主机中<br><br><span class="hljs-comment"># 11.打包镜像</span><br>docker save 镜像名 -o  名称.tar<br><br><span class="hljs-comment"># 12.载入镜像</span><br>docker load -i   名称.tar<br><br><span class="hljs-comment"># 13.容器打包成新的镜像</span><br>docker commit -m <span class="hljs-string">&quot;描述信息&quot;</span> -a <span class="hljs-string">&quot;作者信息&quot;</span>   （容器<span class="hljs-built_in">id</span>或者名称）打包的镜像名称:标签<br><br><span class="hljs-comment"># 14. 容器重新命名</span><br>docker tag [镜像<span class="hljs-built_in">id</span>] [新镜像名称]:[新镜像标签]<br></code></pre></td></tr></table></figure>

<h2 id="6-Docker镜像的原理"><a href="#6-Docker镜像的原理" class="headerlink" title="6. Docker镜像的原理"></a>6. Docker镜像的原理</h2><h3 id="6-1-镜像是什么"><a href="#6-1-镜像是什么" class="headerlink" title="6.1 镜像是什么"></a>6.1 镜像是什么</h3><blockquote>
<p>镜像是一种轻量级的，可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时所需的库、环境变量和配置文件。</p>
</blockquote>
<h3 id="6-2-Docker的镜像原理"><a href="#6-2-Docker的镜像原理" class="headerlink" title="6.2 Docker的镜像原理"></a>6.2 Docker的镜像原理</h3><blockquote>
<p><strong>docker的镜像实际是由一层一层的文件系统组成。</strong></p>
</blockquote>
<ul>
<li>bootfs（boot file system）主要包含bootloader和kernel，bootloader主要是引导加载kernel，Linux刚启动时会加载bootfs文件系统。在docker镜像的最底层就是bootfs。这一层与Linux&#x2F;Unix 系统是一样的，包含boot加载器（bootloader）和内核（kernel）。当boot加载完,后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时会卸载bootfs。</li>
<li>rootfs（root file system），在bootfs之上，包含的就是典型的linux系统中的&#x2F;dev，&#x2F;proc，&#x2F;bin，&#x2F;etc等标准的目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu&#x2F;CentOS等等。</li>
<li>我们平时安装进虚拟机的centos都有1到几个GB，为什么docker这里才200MB？对于一个精简的OS，rootfs可以很小，只需要包括最基本的命令，工具，和程序库就可以了，因为底层直接使用Host的Kernal，自己只需要提供rootfs就行了。由此可见不同的linux发行版，他们的bootfs是一致的，rootfs会有差别。因此不同的发行版可以共用bootfs。</li>
</ul>
<p><img src="https://i.imgur.com/mYIKz3o.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><code>UnionFS</code> (联合文件系统)： Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持<strong>对文件系统的修改作为一次提交来一层层的叠加</strong>，同时可以将不同的目录挂载到同一个虚拟机文件系统下，Union文件系统是Docker镜像的基础。<strong>镜像可以通过分层来进行继承</strong>，基于基础镜像（没有父镜像），可以用来制作各种具体的应用镜像。</p>
<p>特性： 一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录</p>
<blockquote>
<p>怎么理解？当我们执行docker pull 的时候会拉取很多模块</p>
</blockquote>
<h2 id="7-Docker安装常用服务"><a href="#7-Docker安装常用服务" class="headerlink" title="7. Docker安装常用服务"></a>7. Docker安装常用服务</h2><h3 id="7-1-ETCD"><a href="#7-1-ETCD" class="headerlink" title="7.1 ETCD"></a>7.1 ETCD</h3><ol>
<li><p>拉取镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull bitnami/etcd:3.5.9<br></code></pre></td></tr></table></figure>
</li>
<li><p>准备挂载目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p ~/docker/etcd/data ~/docker/etcd/conf<br><br><span class="hljs-built_in">chmod</span> -R 777 ~/docker/etcd/data <br><span class="hljs-built_in">chmod</span> -R 777 ~/docker/etcd/conf<br></code></pre></td></tr></table></figure>


</li>
<li><p>准备配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim ~/docker/etcd/conf/etcd.yml<br></code></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#成员名称</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">etcd01</span><br><span class="hljs-comment"># 数据保存路径</span><br><span class="hljs-attr">data-dir:</span> <span class="hljs-string">/data</span><br><span class="hljs-comment">#对外提供服务的地址</span><br><span class="hljs-attr">listen-client-urls:</span> <span class="hljs-string">http://0.0.0.0:2379</span><br><span class="hljs-comment">#成员之间通信地址</span><br><span class="hljs-attr">listen-peer-urls:</span> <span class="hljs-string">http://0.0.0.0:2380</span><br><span class="hljs-comment">#此成员的客户端URL列表，用于通告群集的其余部分。这些URL可以包含域名</span><br><span class="hljs-attr">advertise-client-urls:</span> <span class="hljs-string">http://etcd01:2379</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>创建容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d --name etcd -p 2379:2379 -p 2380:2380 \<br>-e ALLOW_NONE_AUTHENTICATION=<span class="hljs-built_in">yes</span> \<br>-e ETCD_CONFIG_FILE=/opt/bitnami/etcd/conf/etcd.yml \<br>-v ~/docker/etcd/data:/data \<br>-v ~/docker/etcd/conf:/opt/bitnami/etcd/conf \<br>bitnami/etcd:3.5.9<br></code></pre></td></tr></table></figure>
</li>
<li><p>进入 ETCD</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -u root -it etcd /bin/bash<br></code></pre></td></tr></table></figure>
</li>
<li><p>设置开机自启</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker update --restart=always etcd<br></code></pre></td></tr></table></figure>
</li>
<li><p>其他</p>
<p><a href="https://xie.infoq.cn/link?target=https://github.com/etcd-io/etcd/blob/main/etcd.conf.yml.sample">详细配置文件地址</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 验证安装</span><br>etcd --version<br></code></pre></td></tr></table></figure>

<ol>
<li><p>增加认证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 以下命令都需要进入 etcd 容器 shell</span><br>etcdctl user add root --interactive <span class="hljs-comment"># 增加用户 并以命令行形式设置密码</span><br>etcdctl role add root <span class="hljs-comment"># 增加root</span><br>etcdctl user grant-role root root <span class="hljs-comment"># 给 root 设置 root权限</span><br>etcdctl auth <span class="hljs-built_in">enable</span> <span class="hljs-comment"># 开启认证</span><br><br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h3 id="7-2-MySQL"><a href="#7-2-MySQL" class="headerlink" title="7.2 MySQL"></a>7.2 MySQL</h3><ol>
<li><p>拉取镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull mysql:5.7<br></code></pre></td></tr></table></figure>
</li>
<li><p>准备挂载目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /root/docker/mysql/data /root/docker/mysql/conf.d:/etc/mysql/conf.d <br></code></pre></td></tr></table></figure>
</li>
<li><p>创建容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run --name mysql -v /root/docker/mysql/data:/var/lib/mysql -v /root/docker/mysql/conf.d:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=root -p 13306:3306 -d mysql:5.7<br></code></pre></td></tr></table></figure></li>
</ol>
<h2 id="8-Dockerfile"><a href="#8-Dockerfile" class="headerlink" title="8. Dockerfile"></a>8. Dockerfile</h2><h3 id="8-1-什么是Dockerfile"><a href="#8-1-什么是Dockerfile" class="headerlink" title="8.1 什么是Dockerfile"></a>8.1 什么是Dockerfile</h3><p>Dockerfile可以认为是<strong>Docker镜像的描述文件，是由一系列命令和参数构成的脚本</strong>。主要作用是<strong>用来构建docker镜像的构建文件</strong>。</p>
<p><img src="https://i.imgur.com/teEfIcy.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li>通过架构图可以看出Docker file 可以直接构建镜像</li>
</ul>
<h3 id="8-2-Docker-file解析过程"><a href="#8-2-Docker-file解析过程" class="headerlink" title="8.2 Docker file解析过程"></a>8.2 Docker file解析过程</h3><p><img src="https://i.imgur.com/4y60ija.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="8-3-Dockerfile的保留命令"><a href="#8-3-Dockerfile的保留命令" class="headerlink" title="8.3 Dockerfile的保留命令"></a>8.3 Dockerfile的保留命令</h3><p>官方说明:<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a></p>
<table>
<thead>
<tr>
<th align="left">保留字</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>FROM</strong></td>
<td align="left"><strong>当前镜像是基于哪个镜像的</strong> <code>第一个指令必须是FROM</code></td>
</tr>
<tr>
<td align="left">MAINTAINER</td>
<td align="left">镜像维护者的姓名和邮箱地址</td>
</tr>
<tr>
<td align="left"><strong>RUN</strong></td>
<td align="left"><strong>构建镜像时需要运行的指令</strong></td>
</tr>
<tr>
<td align="left"><strong>EXPOSE</strong></td>
<td align="left"><strong>当前容器对外暴露出的端口号</strong></td>
</tr>
<tr>
<td align="left"><strong>WORKDIR</strong></td>
<td align="left"><strong>指定在创建容器后，终端默认登录进来的工作目录，一个落脚点</strong></td>
</tr>
<tr>
<td align="left"><strong>ENV</strong></td>
<td align="left"><strong>用来在构建镜像过程中设置环境变量</strong></td>
</tr>
<tr>
<td align="left"><strong>ADD</strong></td>
<td align="left"><strong>将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压tar包</strong></td>
</tr>
<tr>
<td align="left"><strong>COPY</strong></td>
<td align="left"><strong>类似于ADD，拷贝文件和目录到镜像中 将从构建上下文目录中&lt;原路径&gt;的文件&#x2F;目录复制到新的一层的镜像内的&lt;目标路径&gt;位置</strong></td>
</tr>
<tr>
<td align="left"><strong>VOLUME</strong></td>
<td align="left"><strong>容器数据卷，用于数据保存和持久化工作</strong></td>
</tr>
<tr>
<td align="left"><strong>CMD</strong></td>
<td align="left"><strong>指定一个容器启动时要运行的命令 Dockerfile中可以有多个CMD指令，但只有最后一个生效，CMD会被docker run之后的参数替换</strong></td>
</tr>
<tr>
<td align="left"><strong>ENTRYPOINT</strong></td>
<td align="left"><strong>指定一个容器启动时要运行的命令 ENTRYPOINT的目的和CMD一样，都是在指定容器启动程序及其参数</strong></td>
</tr>
</tbody></table>
<h4 id="8-3-1-FROM-命令"><a href="#8-3-1-FROM-命令" class="headerlink" title="8.3.1 FROM 命令"></a>8.3.1 FROM 命令</h4><ul>
<li><p>基于哪个镜像进行构建新的镜像,在构建时会自动从docker hub拉取base镜像 必须作为Dockerfile的第一个指令出现</p>
</li>
<li><p>语法</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span>  &lt;image&gt;<br><span class="hljs-keyword">FROM</span>  &lt;image&gt;[:&lt;tag&gt;]     使用版本不写为latest<br><span class="hljs-keyword">FROM</span>  &lt;image&gt;[@&lt;digest&gt;]  使用摘要<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-3-2-MAINTAINER-命令"><a href="#8-3-2-MAINTAINER-命令" class="headerlink" title="8.3.2 MAINTAINER 命令"></a>8.3.2 MAINTAINER 命令</h4><ul>
<li><p>镜像维护者的姓名和邮箱地址[废弃]</p>
</li>
<li><p>语法：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">MAINTAINER</span> &lt;name&gt;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-3-3-RUN-命令"><a href="#8-3-3-RUN-命令" class="headerlink" title="8.3.3 RUN 命令"></a>8.3.3 RUN 命令</h4><ul>
<li><p>RUN指令将在当前映像之上的新层中执行任何命令并提交结果。生成的提交映像将用于Dockerfile中的下一步</p>
</li>
<li><p>语法：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">RUN</span><span class="language-bash"> &lt;<span class="hljs-built_in">command</span>&gt; (shell form, the <span class="hljs-built_in">command</span> is run <span class="hljs-keyword">in</span> a shell, <span class="hljs-built_in">which</span> by default is /bin/sh -c on Linux or cmd /S /C on Windows)</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> hello</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> [<span class="hljs-string">&quot;executable&quot;</span>, <span class="hljs-string">&quot;param1&quot;</span>, <span class="hljs-string">&quot;param2&quot;</span>] (<span class="hljs-built_in">exec</span> form)</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> [<span class="hljs-string">&quot;/bin/bash&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;echo hello&quot;</span>]</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-3-4-EXPOSE-命令"><a href="#8-3-4-EXPOSE-命令" class="headerlink" title="8.3.4 EXPOSE 命令"></a>8.3.4 EXPOSE 命令</h4><ul>
<li><p>用来指定构建的镜像在运行为容器时对外暴露的端口</p>
</li>
<li><p>语法：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">80</span>/tcp  如果没有显示指定则默认暴露都是tcp<br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">80</span>/udp<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-3-5-CMD-命令"><a href="#8-3-5-CMD-命令" class="headerlink" title="8.3.5 CMD 命令"></a>8.3.5 CMD 命令</h4><ul>
<li><p>用来为启动的容器指定执行的命令,在Dockerfile中只能有一条CMD指令。如果列出多个命令，则只有最后一个命令才会生效。</p>
</li>
<li><p>注意: <strong>Dockerfile中只能有一条CMD指令。如果列出多个命令，则只有最后一个命令才会生效。</strong></p>
</li>
<li><p>语法：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;executable&quot;</span>,<span class="hljs-string">&quot;param1&quot;</span>,<span class="hljs-string">&quot;param2&quot;</span>] (<span class="hljs-built_in">exec</span> form, this is the preferred form)</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;param1&quot;</span>,<span class="hljs-string">&quot;param2&quot;</span>] (as default parameters to ENTRYPOINT)</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> <span class="hljs-built_in">command</span> param1 param2 (shell form)</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-3-6-WORKDIR-命令"><a href="#8-3-6-WORKDIR-命令" class="headerlink" title="8.3.6 WORKDIR 命令"></a>8.3.6 WORKDIR 命令</h4><ul>
<li><p>用来为Dockerfile中的任何RUN、CMD、ENTRYPOINT、COPY和ADD指令设置工作目录。如果WORKDIR不存在，即使它没有在任何后续Dockerfile指令中使用，它也将被创建。</p>
</li>
<li><p>语法：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /path/to/workdir</span><br><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /a</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> b</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> c</span><br>`注意:<span class="hljs-keyword">WORKDIR</span><span class="language-bash">指令可以在Dockerfile中多次使用。如果提供了相对路径，则该路径将与先前WORKDIR指令的路径相对`</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-3-7-ENV-命令"><a href="#8-3-7-ENV-命令" class="headerlink" title="8.3.7 ENV 命令"></a>8.3.7 ENV 命令</h4><ul>
<li><p>用来为构建镜像设置环境变量。这个值将出现在构建阶段中所有后续指令的环境中。</p>
</li>
<li><p>语法：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">ENV</span> &lt;key&gt; &lt;value&gt;<br><span class="hljs-keyword">ENV</span> &lt;key&gt;=&lt;value&gt; ...<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-3-8-ADD-命令"><a href="#8-3-8-ADD-命令" class="headerlink" title="8.3.8 ADD 命令"></a>8.3.8 ADD 命令</h4><ul>
<li><p>用来从context上下文复制新文件、目录或远程文件url，并将它们添加到位于指定路径的映像文件系统中。</p>
</li>
<li><p>语法：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">ADD</span><span class="language-bash"> hom* /mydir/       通配符添加多个文件</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> hom?.txt /mydir/   通配符添加</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> test.txt relativeDir/  可以指定相对路径</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> test.txt /absoluteDir/ 也可以指定绝对路径</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> url </span><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-3-9-COPY-命令"><a href="#8-3-9-COPY-命令" class="headerlink" title="8.3.9 COPY 命令"></a>8.3.9 COPY 命令</h4><ul>
<li><p>用来将context目录中指定文件复制到镜像的指定目录中</p>
</li>
<li><p>语法：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">COPY</span><span class="language-bash"> src dest</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> [<span class="hljs-string">&quot;&lt;src&gt;&quot;</span>,... <span class="hljs-string">&quot;&lt;dest&gt;&quot;</span>]</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-3-10-VOLUME-命令"><a href="#8-3-10-VOLUME-命令" class="headerlink" title="8.3.10 VOLUME 命令"></a>8.3.10 VOLUME 命令</h4><ul>
<li><p>用来定义容器运行时可以挂在到宿主机的目录</p>
</li>
<li><p>语法：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">VOLUME</span><span class="language-bash"> [<span class="hljs-string">&quot;/data&quot;</span>]</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-3-11-ENTRYPOINT-命令"><a href="#8-3-11-ENTRYPOINT-命令" class="headerlink" title="8.3.11 ENTRYPOINT 命令"></a>8.3.11 ENTRYPOINT 命令</h4><ul>
<li><p>用来指定容器启动时执行命令和CMD类似</p>
</li>
<li><p>语法：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">[<span class="hljs-string">&quot;executable&quot;</span>, <span class="hljs-string">&quot;param1&quot;</span>, <span class="hljs-string">&quot;param2&quot;</span>]<br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> <span class="hljs-built_in">command</span> param1 param2</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="8-4-Dockerfile构建SpringBoot应用"><a href="#8-4-Dockerfile构建SpringBoot应用" class="headerlink" title="8.4 Dockerfile构建SpringBoot应用"></a>8.4 Dockerfile构建SpringBoot应用</h3><ol>
<li><p>创建Spring Boot应用</p>
</li>
<li><p>执行打包命令</p>
</li>
<li><p>创建Dockerfile</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> openjdk:<span class="hljs-number">17</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /java-demo</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> docker-spring-boot-0.0.1-SNAPSHOT.jar /java-demo</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8080</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;java&quot;</span>, <span class="hljs-string">&quot;-jar&quot;</span>]</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;docker-spring-boot-0.0.1-SNAPSHOT.jar&quot;</span>]</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>构建镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker build -t docker-springboot-demo .<br></code></pre></td></tr></table></figure>
</li>
<li><p>运行镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d -p 8081:8080 docker-springboot-demo<br></code></pre></td></tr></table></figure>
</li>
<li><p>访问项目</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl --location <span class="hljs-string">&#x27;http://localhost:8081/index&#x27;</span><br></code></pre></td></tr></table></figure></li>
</ol>
<h2 id="9-Docker网络"><a href="#9-Docker网络" class="headerlink" title="9. Docker网络"></a>9. Docker网络</h2><p>当项目大规模使用 Docker 时，容器通信的问题也就产生了。要解决容器通信问题，必须先了解很多关于网络的知识。Docker 作为目前最火的轻量级容器技术，有很多令人称道的功能，如 Docker 的镜像管理。然而，Docker 同样有着很多不完善的地方，网络方面就是 Docker 比较薄弱的部分。因此，我们有必要深入了解 Docker 的网络知识，以满足更高的网络需求。</p>
<p>我们在启动docker的时候，主机会有增加一个docker0的网络</p>
<p><img src="https://i.imgur.com/nZMAhP9.png" srcset="/img/loading.gif" lazyload alt="image-20240513221855243"></p>
<blockquote>
<p>默认网络</p>
</blockquote>
<p>安装 Docker 以后，会默认创建三种网络，可以通过 <code>docker network ls</code> 查看。</p>
<p><img src="https://i.imgur.com/HNAdhQ7.png" srcset="/img/loading.gif" lazyload alt="image-20240513222000607"></p>
<ul>
<li><p>bridge 网络模式</p>
<p>在该模式中，Docker 守护进程创建了一个虚拟以太网桥 <code>docker0</code>，新建的容器会自动桥接到这个接口，附加在其上的任何网卡之间都能自动转发数据包，并为每一个容器分配、设置IP等，并将容器连接到一个<code>docker0</code></p>
<p>虚拟网桥，默认为该模式</p>
</li>
<li><p>host 网络模式</p>
<p>容器将不会虚拟出自己的网卡，配置自己的IP等，而是使用宿主机的IP和端口</p>
</li>
<li><p>none 网络模式</p>
<p>容器具有独立的Network namespace, 但并没有对其进行任何网络设置，如分配veth part和网桥连接，IP等</p>
</li>
<li><p>container 网络模式</p>
<p>新创建的容器不会创建自己的网卡和配置自己的IP，而是和一个指定的容器共享IP、端口范围等</p>
</li>
</ul>
<h3 id="9-1-Docker-网络常用命令"><a href="#9-1-Docker-网络常用命令" class="headerlink" title="9.1 Docker 网络常用命令"></a>9.1 Docker 网络常用命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker network --<span class="hljs-built_in">help</span><br><br>Usage:  docker network COMMAND<br><br>Manage networks<br><br>Commands:<br>  connect     Connect a container to a network<br>  create      Create a network<br>  disconnect  Disconnect a container from a network<br>  inspect     Display detailed information on one or more networks<br>  <span class="hljs-built_in">ls</span>          List networks<br>  prune       Remove all unused networks<br>  <span class="hljs-built_in">rm</span>          Remove one or more networks<br><br>Run <span class="hljs-string">&#x27;docker network COMMAND --help&#x27;</span> <span class="hljs-keyword">for</span> more information on a <span class="hljs-built_in">command</span>.<br></code></pre></td></tr></table></figure>

<h3 id="9-2-Docker-网络能干嘛"><a href="#9-2-Docker-网络能干嘛" class="headerlink" title="9.2 Docker 网络能干嘛"></a>9.2 Docker 网络能干嘛</h3><ul>
<li>容器间的互联和通信以及端口映射</li>
<li>容器IP变动时候可以通过服务名直接网络通信而不收到任何影响</li>
</ul>
<h3 id="9-3-Docker-容器之间内部的通信"><a href="#9-3-Docker-容器之间内部的通信" class="headerlink" title="9.3 Docker 容器之间内部的通信"></a>9.3 Docker 容器之间内部的通信</h3><blockquote>
<p>Tips 通过自建网络实现</p>
</blockquote>
<ol>
<li><p>准备所需要环境</p>
<p>笔者使用ubuntu镜像实现，需要先拉取对应镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull ubuntu<br>docker images<br></code></pre></td></tr></table></figure>

<blockquote>
<p>如果出现docker search 可以使用，docker pull 失败的问题可以尝试看看是否是DNS的问题 &#x2F;etc</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/resolv.conf<br></code></pre></td></tr></table></figure>

<p><img src="https://i.imgur.com/6BhHiZO.png" srcset="/img/loading.gif" lazyload alt="image-20240514184217779"></p>
</li>
<li><p>创建网络</p>
<p>如果不清楚docker network命令可以使用<code>docker network --help</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker network create test-network<br></code></pre></td></tr></table></figure>

<p>创建网络之后执行<code>docker network ls</code>看看是否执行成功</p>
</li>
<li><p>启动容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 启动两个docker容器</span><br>docker run -it --name u1 --network test-network --network-alias ubuntu1  ubuntu bash<br>docker run -it --name u2 --network test-network --network-alias ubuntu2  ubuntu bash<br>   <br></code></pre></td></tr></table></figure>

<ul>
<li>–network 指定网络</li>
<li>–network-alias 指定网络名称（类似于主机名称，后续可以直接通过<code>ping</code>这个主机）</li>
</ul>
</li>
<li><p>安装容器环境</p>
<p>启动的容器是没有<code>ifconfig</code>,<code>ping</code>这些命令的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt update &amp;&amp; apt install -y net-tools &amp;&amp; apt install -y iputils-ping<br><br></code></pre></td></tr></table></figure>
</li>
<li><p>测试</p>
<p>分别启动两个容器，并进入<code>shell</code>，进入容器命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -it [container_id] bash<br></code></pre></td></tr></table></figure>

<p>效果图：</p>
<p><img src="https://i.imgur.com/C9PS4pG.jpeg" srcset="/img/loading.gif" lazyload alt="image-20240514184129680"></p>
</li>
</ol>
<h2 id="9-Docker-Compose"><a href="#9-Docker-Compose" class="headerlink" title="9. Docker Compose"></a>9. Docker Compose</h2><h3 id="9-1-简介"><a href="#9-1-简介" class="headerlink" title="9.1 简介"></a>9.1 简介</h3><p><code>Compose</code> 项目是 Docker 官方的开源项目，负责实现对 Docker 容器集群的快速编排。从功能上看，跟 <code>OpenStack</code> 中的 <code>Heat</code> 十分类似。</p>
<h3 id="9-2-docker-compose-安装"><a href="#9-2-docker-compose-安装" class="headerlink" title="9.2 docker-compose 安装"></a>9.2 docker-compose 安装</h3><blockquote>
<p>官网： <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/compose-file-v3/">https://docs.docker.com/compose/compose-file/compose-file-v3/</a></p>
<p>下载地址：<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/install">https://docs.docker.com/compose/install</a></p>
</blockquote>
<h3 id="9-3-docker-compose"><a href="#9-3-docker-compose" class="headerlink" title="9.3 docker compose"></a>9.3 docker compose</h3><ol>
<li><p>To download and install Compose standalone, run:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -SL https://github.com/docker/compose/releases/download/v2.27.0/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose<br></code></pre></td></tr></table></figure>
</li>
<li><p>Apply executable permissions to the standalone binary in the target path for the installation.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> +x /usr/local/bin/docker-compose<br></code></pre></td></tr></table></figure>
</li>
<li><p>Test and execute compose commands using <code>docker-compose</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-compose --version<br></code></pre></td></tr></table></figure>

<p><img src="https://i.imgur.com/CxmN9fd.png" srcset="/img/loading.gif" lazyload alt="image-20240514212055991"></p>
</li>
</ol>
<h3 id="9-4-docker-compose常用命令"><a href="#9-4-docker-compose常用命令" class="headerlink" title="9.4 docker-compose常用命令"></a>9.4 docker-compose常用命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-compose -h 								<span class="hljs-comment"># 查看帮助</span><br>docker-compose up 								<span class="hljs-comment"># 启动所有服务</span><br>docker-compose up -d 							<span class="hljs-comment"># 启动所有docker-compose服务并后台运行</span><br>docker-compose down 							<span class="hljs-comment"># 停止并删除容器、网络、卷、镜像</span><br>docker-compose <span class="hljs-built_in">exec</span> [yml里面的服务<span class="hljs-built_in">id</span>] 			 <span class="hljs-comment"># 进入容器实例内部</span><br>docker-compose ps 								<span class="hljs-comment"># 展示当前docker-compose编排过的运行的容器</span><br>docker-compose top 								<span class="hljs-comment"># 展示当前docker-compose编排过的容器进程</span><br><br>docker-compose logs [yml里面的服务<span class="hljs-built_in">id</span>] 			 <span class="hljs-comment"># 查看容器输出日志</span><br>docker-compose config 							<span class="hljs-comment"># 检查配置</span><br>docker-compose config -q 						<span class="hljs-comment"># 检查配置，有问题才输出</span><br>docker-compose restart 							<span class="hljs-comment"># 重启服务</span><br>docker-compose start 							<span class="hljs-comment"># 启动服务</span><br>docker-compose stop 							<span class="hljs-comment"># 停止服务</span><br></code></pre></td></tr></table></figure>

<h3 id="9-5-docker-compose-使用"><a href="#9-5-docker-compose-使用" class="headerlink" title="9.5 docker-compose 使用"></a>9.5 docker-compose 使用</h3><ol>
<li><p>构建镜像（基于Spring Boot）</p>
<ol>
<li><p>编写代码</p>
</li>
<li><p>配置文件修改</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">spring.application.name</span>=<span class="hljs-string">docker-compose</span><br><span class="hljs-attr">spring.datasource.driver-class-name</span>=<span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br><span class="hljs-attr">spring.datasource.url</span>=<span class="hljs-string">jdbc://mysql:13306/compose?useUnicode=true&amp;useSSL=false</span><br><span class="hljs-attr">spring.datasource.username</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">spring.datasource.password</span>=<span class="hljs-string">root</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>编写Dockerfile、docker-compose.yml</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> openjdk:<span class="hljs-number">17</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /java-demo</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> docker-compose-0.0.1-SNAPSHOT.jar /java-demo</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8080</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;java&quot;</span>, <span class="hljs-string">&quot;-jar&quot;</span>]</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;docker-compose-0.0.1-SNAPSHOT.jar&quot;</span>]</span><br></code></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">composeService:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">docker-compose:1.6</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">dc1.6</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;6001:6001&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/docker/compose/java-demo:/java-demo</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">compose_net</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">mysql</span><br>  <span class="hljs-attr">mysql:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:5.7</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">root</span><br>      <span class="hljs-attr">MYSQL_ALLOW_EMPTY_PASSWORD:</span> <span class="hljs-string">&quot;no&quot;</span><br>      <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">&quot;compose&quot;</span><br>      <span class="hljs-attr">MYSQL_USER:</span> <span class="hljs-string">&quot;root&quot;</span><br>      <span class="hljs-attr">MYSQL_PASSWORD:</span> <span class="hljs-string">&quot;root&quot;</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;3306:3306&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/docker/compose/mysql/db:/var/lib/mysql</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/docker/compose/conf/my.cnf:/etc/my.cnf</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/docker/compose/mysql/init:/docker-entrypoint-initdb.d</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">compose_net</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">--default-authentication-plugin=mysql_native_password</span> <span class="hljs-comment"># 解决外部无法访问</span><br><span class="hljs-attr">networks:</span><br>    <span class="hljs-attr">compose_net:</span><br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>上传镜像和相关文件</p>
</li>
<li><p>构建镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker build -t docker-compose:1.6 .<br></code></pre></td></tr></table></figure>
</li>
<li><p>执行核心操作</p>
<ul>
<li>docker-compose up -d</li>
</ul>
</li>
</ol>
<blockquote>
<p>总结 尽量不要使用docker-compose 不好用</p>
</blockquote>
<h2 id="10-异常处理"><a href="#10-异常处理" class="headerlink" title="10. 异常处理"></a>10. 异常处理</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@localhost ~]<span class="hljs-comment"># docker search mysql 或者 docker pull 这些命令无法使用</span><br>Error response from daemon: Get https://index.docker.io/v1/search?q=mysql&amp;n=25: x509: certificate has expired or is not yet valid<br></code></pre></td></tr></table></figure>

<blockquote>
<p>这个错误的原因是因为系统的时间和docker hub时间不一致，需要做系统时间与网络时间同步</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1.安装时间同步</span><br>	sudo yum -y install ntp ntpdate<br><span class="hljs-comment"># 2.同步时间</span><br>	sudo ntpdate cn.pool.ntp.org<br><span class="hljs-comment"># 3.查看本机时间</span><br>	<span class="hljs-built_in">date</span><br><span class="hljs-comment"># 4.重新测试</span><br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%AE%B9%E5%99%A8/" class="category-chain-item">容器</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" class="print-no-link">#微服务</a>
      
        <a href="/tags/Docker/" class="print-no-link">#Docker</a>
      
    </div>
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/05/11/GNULinux%20%E7%BB%88%E7%AB%AF%E4%B8%8B%E4%BD%BF%E7%94%A8%20Fish%20shell%20%E5%B9%B6%E7%BE%8E%E5%8C%96/" title="Fish Shell">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Fish Shell</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/05/11/Go%E7%B3%BB%E5%88%97/Go%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A6%82%E8%A7%88/" title="微服务概览">
                        <span class="hidden-mobile">微服务概览</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    
      <script type="text/javascript">
        var disqus_config = function() {
          this.page.url = 'https://hailong-bot.github.io/2024/05/11/Docker/';
          this.page.identifier = '/2024/05/11/Docker/';
        };
        Fluid.utils.loadComments('#disqus_thread', function() {
          var d = document, s = d.createElement('script');
          s.src = '//' + 'fluid' + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', new Date());
          (d.head || d.body).appendChild(s);
        });
      </script>
    
    <noscript>Please enable JavaScript to view the comments</noscript>
  </div>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>phoenix</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
